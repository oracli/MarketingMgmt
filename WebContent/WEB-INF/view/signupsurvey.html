<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>报名调查</title>
		<link href="css/style.css" rel="stylesheet" />
		<link href="css/weui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/frozen.css">
		<script src="js/jquery-3.2.1.min.js"></script>
		<script src="js/weui.min.js"></script>
		<script src="js/zepto.min.js"></script>
		<script src="js/func.js"></script>
	</head>

	<body>
		<form id="survey" method="post" action="submitSurvey">
			<header class="ui-header ui-header-positive ui-border-b">
				
				<i class="ui-icon-return" onclick="history.back()"></i>
				
				<div class="ui-row">
 					<div class="ui-col ui-col-80"><h1>报名调查问卷</h1></div>
    				<div class="ui-col ui-col-20"><a href="javascript:gomarketingentry();"><div class="ui-badge-muted">回首页</div></a></div>		    			
    			</div>

			</header>
			<br />

			<div class="page__bd">

				<article class="weui-article">
	
					<div class="weui-cells weui-cells_form">

						<div class="ui-row">
 							<div class="ui-col ui-col-80"><h5>你可以选择放弃填写调查问卷，但是你将不能参与本次活动</h5></div>
    						<div class="ui-col ui-col-20"><a href="javascript:gobackmarktingindex();" class="weui-btn weui-btn_mini weui-btn_default">放弃</a></div>		    			
    					</div>

					</div>
					
					<div class="weui-cells weui-cells_form">
		
						<h3>请填写下面问题，并提交。。。。</h3>
						<br />
					</div>
					
					<input type="hidden" id="surveyid" value="a8623f48-5642-7273-fa8a-5987da775c2d"/>		
						<div id="searchresult">
						</div>
	
				</article>
				
			</div>
		

			<div class="page__bd page__bd_spacing">
				<div class="page-btn-area">
					<a class="page-btn page-btn_primary" href="javascript:submitSurvey();">提交</a>
						<input type="hidden" id="followid" name="followid" value="1" />
						<input type="hidden" id="membertel" name="membertel" value="2" />
				</div>
			</div>
		</form>

		<div class="weui-footer">
			<br />
			<br />
			<p class="weui-footer__links">
				<a href="javascript:;" class="weui-footer__link">关于我们</a>
			</p>
			<p class="weui-footer__text">Copyright &copy; 2007-2017 XXXXX</p>
		</div>
	
	
		<script type="text/html" id="question-header">			
			<div class="page-hd">
				<p class="page-title"><#= name #></p>
				<input type="hidden" name = "sid" value = "<#= id #>"/>
			</div>			
		</script>
		<script type="text/html" id="question-list">
			<div class="weui-cell__hd">
				<p><#= name #></p>
				<input type="hidden" name="<#= qtag #>" value = "<#= id #>"/>
			</div>	
		</script>
		<script type="text/html" id="option-list">
			<div class="weui-cells weui-cells_radio">
            	<label class="weui-cell weui-check__label" for="<#= id #>">
                	<div class="weui-cell__bd">
                    	<p><#= name #></p>
                	</div>
                	<div class="weui-cell__ft">
                    	<input type="radio" name ="<#= tag #>" id="<#= id #>" value="<#= id #>"/>
                    	<span class="weui-icon-checked"></span>
                	</div>
            	</label>            
        	</div>
		</script>

		<script type="text/javascript">
			//提交问卷后，返回本次活动首页
			function gobackmarktingindex() {

				$.ajax({
					type: 'get',
					url: 'marketingindex',
					cache: false,
					async: false,
					dataType: 'json',
					　　　　　　contentType: 'application/json',
					success: function(data) {
						window.location.href = 'marketingindex';
					},
					error: function(data) {
						alert(data.msg);
					}
				});
			}		
			//提交问卷后，返回本次活动首页
			function gobackmarktingindex() {

				$.ajax({
					type: 'get',
					url: 'marketingindex',
					cache: false,
					async: false,
					dataType: 'json',
					　　　　　　contentType: 'application/json',
					success: function(data) {
						window.location.href = 'marketingindex';
					},
					error: function(data) {
						alert(data.msg);
					}
				});
			}	
			//返回营销活动入口
			function gomarketingentry() {

				$.ajax({
					type: 'get',
					url: 'marketingentry',
					cache: false,
					async: false,
					dataType: 'json',
					　　　　　　contentType: 'application/json',
					success: function(data) {
						window.location.href = 'marketingentry';
					},
					error: function(data) {
						alert(data.msg);
					}
				});
			}
			
			//初始化页面
			function getSurvey(){
				var surveyid = document.getElementById('surveyid').value;
				var params = {id: surveyid};
				
				$.ajax({  
			        type: 'get',  
			        url: 'getQuestionnaire',
			        cache: false,
			        dataType : 'json',
			        data: params,
			　　　　　　 	contentType : 'application/json', 
			　　　　　　 	async: false,
			        success: function (data) { 				        				        	
			        	var htmllist = parseQATemplate(data);			        	
			        	$('#searchresult').html(htmllist);			        				        	
			        },  
			        error: function (data) { 		        	
			        	alert('failed:' + data.msg);
			        }  
			    });
			}
			
			function parseQATemplate(data){
				var err = "";
				var resultHtml = ""; 
				try{
					resultHtml = $('#question-header').parseTemplate(data);
					var i = 1;
					data.questions.forEach(function(object) {
						object.qtag = 'qid_' + i;
						resultHtml += $('#question-list').parseTemplate(object);
						object.options.forEach(function(item){
							item.tag = object.id;
							resultHtml += $('#option-list').parseTemplate(item);
						});
						i ++;
					});
					return resultHtml;
				}catch(e){
					err = e.message;
				}
				return "< # ERROR: " + err.toString() + " # >";
			};

			jQuery.getUrlParam = function (name) {
     			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
     			var r = window.location.search.substr(1).match(reg);
     			if (r != null) return unescape(r[2]); return null;
			}			
			$(document).ready(function() {
				
				//$("#memberid").val($.getUrlParam('mdid'));

				getSurvey();
			});			
			
			//回写答案
			function submitSurvey(){
				
				$('#survey').submit();
			}			
			
		</script>
	</body>

</html>